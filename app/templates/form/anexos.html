{% extends "form/crearp.html" %}

{% load static %}
{% block forms %}
<div class="accordion" id="accordionExample">
    <div class="d-flex justify-content-center col-12">
        <h5 class="bg-custom-green pt-3 pb-3 mb-2 border_radius centradow w-100 text-center">ANEXOS</h5>
    </div>

    <div class="card">
        <div id="headingOne">
        </div>
        <!-- Contenido de primer boton -->
        <div id="collapseOne" class="collapse show" aria-labelledby="headingOne" data-bs-parent="#accordionExample">
            <div class="card-body">
                <div class="contenido">
                    <div class="d-flex justify-content-center col-12">
                        <h5 class="bg-custom-green pt-3 pb-3 mb-2 border_radius centradow w-100 text-center">Anexos
                            vinculados al proyecto</h5>
                    </div>
                    <div class="row justify-content-center">
                        <div class="col-12 md-10">
                            <div class="bg-light mt-2 border_radius row me-0">
                                <div class="col-12 md-10">
                                    <form method="post" id="form1" action="" class="needs-validation"
                                        enctype="multipart/form-data">
                                        {% csrf_token %}

                                        <div class="mt-3" style="width: 95%; margin-left: 2%;">

                                            <div class="mb-3">
                                                <div class="mb-3">
                                                    <label for="formFile" class="form-label">ANEXO 1A. Acta Reunión
                                                        Regional</label>
                                                    <input class="form-control" name="anexo1" type="file" id="formFile">
                                                </div>
                                            </div>

                                            <!-- Segundo textarea con label -->
                                            <div class="mb-3">
                                                <div class="mb-3">
                                                    <label for="formFile" class="form-label">ANEXO 1C. Carta C.I
                                                        Director Regional</label>
                                                    <input class="form-control" name="anexo2" type="file" id="formFile">
                                                </div>
                                            </div>
                                            <div class="mb-3">
                                                <div class="mb-3">
                                                    <label for="formFile" class="form-label">ANEXO 2. Ficha técnica para
                                                        maquinaria y equipos.</label>
                                                    <input class="form-control" name="anexo3" type="file" id="formFile">
                                                </div>
                                            </div>
                                            <div class="mb-3">
                                                <div class="mb-3">
                                                    <label for="formFile" class="form-label">ANEXO 4. Modernización.
                                                        (Obligatorio para los proyectos cuyo objeto sea la actualización
                                                        y modernización de ambientes de formación (SIIF 23))</label>
                                                    <input class="form-control" name="anexo4" type="file" id="formFile">
                                                </div>
                                            </div>
                                            <div class="mb-3">
                                                <div class="mb-3">
                                                    <label for="formFile" class="form-label">ANEXO 7. Carta de intención
                                                        o acta que soporta el trabajo articulado con entidades aliadas
                                                        (diferentes al SENA) (Obligatorio si se articula con entidad
                                                        aliada o con otro Centro de Formación)</label>
                                                    <input class="form-control" name="anexo5" type="file" id="formFile">
                                                </div>
                                            </div>
                                            <div class="mb-3">
                                                <div class="mb-3">
                                                    <label for="formFile" class="form-label">ANEXO 8. Propiedad
                                                        intelectual (Obligatorio si se articula con entidad aliada o con
                                                        otro Centro de Formación)</label>
                                                    <input class="form-control" name="anexo6" type="file" id="formFile">
                                                </div>
                                            </div>

                                            <!-- Botón Siguiente centrado -->
                                            <div class="d-flex justify-content-center col-12">
                                                <button type="submit"
                                                    class="btn-bg-green pt-3 pb-3 mb-2 border_radius centradow">Siguiente</button>
                                            </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
    function validarTamanioArchivo(input, maxSizeInBytes) {
        const files = input.files;

        for (let i = 0; i < files.length; i++) {
            if (files[i].size > maxSizeInBytes) {
                Swal.fire({
                    title: 'Advertencia',
                    text: 'El peso del archivo supera el límite',
                    icon: 'warning',
                    confirmButtonText: 'Aceptar'
                });
                input.value = '';
                return false;
            }
        }

        return true;
    }

    const form = document.getElementById('form1');
    form.addEventListener('submit', (event) => {
        const fileInputs = document.querySelectorAll('input[type="file"]');
        const maxSizeInBytes = 5 * 1024 * 1024; // 5 MB

        for (const input of fileInputs) {
            if (!validarTamanioArchivo(input, maxSizeInBytes)) {
                event.preventDefault();
                return;
            }
        }
    });

    const fileInputs = document.querySelectorAll('input[type="file"]');
    const maxSizeInBytes = 5 * 1024 * 1024; // 5 MB

    fileInputs.forEach(input => {
        input.addEventListener('change', () => {
            validarTamanioArchivo(input, maxSizeInBytes);
        });
    });
</script>
{% if success_alert %}
<script>
    Swal.fire({
        title: '¡Éxito!',
        text: 'Información registrada correctamente.',
        icon: 'success',
        confirmButtonText: 'Aceptar'
    });
</script>
{% endif %}

{% if error_alert %}
<script>
    Swal.fire({
        title: 'Error!',
        text: 'Por favor, corrija los errores en el formulario antes de enviar.',
        icon: 'error',
        confirmButtonText: 'Aceptar'
    });
</script>
{% endif %}

{% endblock %}

{% block scripts %}
<script src="{% static 'js/estp_validations.js' %}"></script>
{% endblock %}